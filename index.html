<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Turtle Hug: Standalone Edition</title>
    <style>
        :root { --lake-top: #4fc3f7; --lake-deep: #002633; }
        
        body { 
            margin: 0; 
            background: var(--lake-deep); 
            /* Using system rounded fonts for offline cuddliness */
            font-family: 'Arial Rounded MT Bold', 'Helvetica Round', 'Segoe UI', sans-serif; 
            overflow: hidden; 
            touch-action: manipulation; 
            user-select: none; 
            color: #2e7d32;
        }
        
        #lake { 
            width: 100vw; height: 100vh; 
            background: radial-gradient(circle at 50% 30%, var(--lake-top) 0%, var(--lake-deep) 100%);
            perspective: 1200px; position: relative; overflow: hidden;
        }

        #game-ui { 
            position: absolute; top: 20px; width: 100%; 
            display: flex; justify-content: space-around; 
            color: white; font-size: 32px; 
            text-shadow: 3px 3px 0px rgba(0,0,0,0.2); 
            z-index: 100; pointer-events: none;
        }

        #title-screen, #game-over { 
            position: fixed; inset: 0; 
            background: linear-gradient(to bottom, #f0faff, #c2e9fb);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 200;
        }

        #game-over { display: none; z-index: 250; text-align: center; padding: 20px; }
        
        h1 { font-size: 60px; margin: 10px 0; animation: wobble 3s ease-in-out infinite; }

        .leaderboard {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px; border-radius: 30px; margin: 15px 0;
            width: 300px; box-shadow: 0 8px 0 rgba(0,0,0,0.1);
        }
        .leaderboard h3 { margin: 0 0 10px 0; font-size: 28px; border-bottom: 3px solid #a5d6a7; }
        .score-row { display: flex; justify-content: space-between; font-size: 22px; padding: 5px 0; }

        #name-entry-area { margin-bottom: 15px; }
        input[type="text"] {
            padding: 12px; border-radius: 20px; border: 4px solid #81c784;
            font-size: 22px; width: 200px; text-align: center; outline: none;
            background: #fff;
        }

        .title-turtles-container { display: flex; gap: 40px; margin-bottom: 20px; transform: scale(0.9); }

        .btn-ui { 
            padding: 18px 45px; font-size: 32px; background: #ff8a80; border: 6px solid #ff5252; 
            border-radius: 50px; color: white; cursor: pointer;
            box-shadow: 0 10px 0 #d32f2f; transition: 0.1s; margin: 10px;
        }
        .btn-ui:active { transform: translateY(6px); box-shadow: 0 4px 0 #d32f2f; }
        .btn-small { font-size: 20px; padding: 10px 25px; border-width: 4px; background: #81c784; border-color: #2e7d32; box-shadow: 0 6px 0 #1b5e20; }

        @keyframes wobble {
            0%, 100% { transform: rotate(-2deg) scale(1); }
            50% { transform: rotate(2deg) scale(1.05); }
        }

        .turtle-mover, .turtle-static { position: absolute; width: 220px; height: 160px; z-index: 10; cursor: pointer; background: transparent !important; }
        .turtle-static { position: relative; transform: rotateX(5deg); }
        .turtle-hinge { width: 100%; height: 100%; transform-origin: bottom center; animation: headFirst 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; position: relative; }

        .flipper {
            position: absolute; width: 85px; height: 38px;
            background-color: inherit; filter: brightness(0.8);
            top: 22px; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 1; z-index: 3;
        }
        .flipper.left { left: 8px; border-radius: 85% 15% 85% 35%; transform-origin: 90% 80%; transform: rotate(-5deg) translate(-12px, 15px); }
        .flipper.right { right: 8px; border-radius: 15% 85% 35% 85%; transform-origin: 10% 80%; transform: rotate(5deg) translate(12px, 15px); }

        .hugging .flipper.left { transform: rotate(-178deg); }
        .hugging .flipper.right { transform: rotate(178deg); }

        @keyframes headFirst { 
            0% { transform: rotateX(-90deg) scale(0.3); opacity: 0; } 
            100% { transform: rotateX(5deg) scale(1); opacity: 1; } 
        }

        .head-shape {
            width: 80px; height: 52px; background-color: inherit;
            border-radius: 75% 100% 45% 60%; position: absolute; top: 0; left: 70px; z-index: 5;
            box-shadow: inset -12px -6px 15px rgba(0,0,0,0.3);
        }
        .mouth {
            position: absolute; bottom: 15px; left: 12px; width: 30px; height: 12px;
            border-bottom: 6px solid rgba(0,0,0,0.8); border-radius: 0 0 15px 15px;
            opacity: 0; transform: rotate(-8deg) scaleX(0.4); transition: 0.2s;
        }
        .hugging .mouth { opacity: 1; transform: rotate(-8deg) scaleX(1); }
        .neck-shape { width: 50px; height: 60px; background-color: inherit; filter: brightness(0.7); position: absolute; top: 30px; left: 85px; border-radius: 20px; z-index: 2; }
        .eye { position: absolute; top: 14px; right: 18px; width: 10px; height: 12px; background: #000; border-radius: 50%; transition: 0.2s; }
        .hugging .eye { height: 3px; margin-top: 5px; border-radius: 2px; transform: rotate(10deg); }

        .green-t { background-color: #66bb6a; }
        .yellow-t { background-color: #ffee58; }
        .brown-t { background-color: #8d6e63; }
        .gold-t { 
            background: linear-gradient(135deg, #ffd700 0%, #ffffff 30%, #ffd700 50%, #ffffff 70%, #ffd700 100%);
            background-size: 300% 300%;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.8); animation: goldPulse 1s infinite, goldShine 0.8s infinite linear; 
        }

        .ripple {
            position: absolute; border: 6px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%; pointer-events: none;
            transform: translate(-50%, -50%) rotateX(70deg);
            animation: rippleExpand 2.8s forwards;
        }
        @keyframes rippleExpand {
            0% { width: 0; height: 0; opacity: 1; border-width: 10px; }
            100% { width: 850px; height: 850px; opacity: 0; border-width: 2px; }
        }
    </style>
</head>
<body>
    <div id="lake">
        <div id="title-screen">
            <div class="title-turtles-container">
                <div class="turtle-static" id="title-gold"><div class="turtle-hinge"><div class="flipper left gold-t"></div><div class="flipper right gold-t"></div><div class="head-shape gold-t"><div class="eye"></div><div class="mouth"></div></div><div class="neck-shape gold-t"></div></div></div>
                <div class="turtle-static" id="title-green"><div class="turtle-hinge"><div class="flipper left green-t"></div><div class="flipper right green-t"></div><div class="head-shape green-t"><div class="eye"></div><div class="mouth"></div></div><div class="neck-shape green-t"></div></div></div>
            </div>
            <h1>TURTLE HUG</h1>
            <button class="btn-ui" onclick="triggerTitleHug()">START HUGGING</button>
        </div>

        <div id="game-over">
            <h1>TIME'S UP!</h1>
            <h2 style="color: #ff5252; margin: 5px; font-size: 32px;">Hugs: <span id="final-score">0</span></h2>
            <div id="name-entry-area">
                <input type="text" id="player-name" placeholder="YOUR NAME" maxlength="10">
                <button class="btn-ui btn-small" onclick="submitScore()">SAVE SCORE</button>
            </div>
            <div class="leaderboard"><h3>TOP HUGGERS</h3><div id="score-list"></div></div>
            <button class="btn-ui" onclick="restartGame()">HUG AGAIN</button>
        </div>

        <div id="game-ui">
            <div>HUGS: <span id="score">0</span></div>
            <div>TIME: <span id="timer">60</span></div>
        </div>
    </div>

<script>
    let score = 0; let timeLeft = 60; let gameActive = false;
    const lake = document.getElementById('lake');
    let audioCtx;
    const scale = [164.81, 185.00, 207.65, 246.94, 277.18, 329.63, 415.30]; 

    function triggerTitleHug() {
        document.getElementById('title-gold').classList.add('hugging');
        document.getElementById('title-green').classList.add('hugging');
        setTimeout(startGame, 600);
    }

    function playMelodicBackground() {
        if (!gameActive) return;
        const now = audioCtx.currentTime;
        const freq = scale[Math.floor(Math.random() * scale.length)];
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.frequency.setValueAtTime(freq, now);
        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(0.3, now + 0.5); 
        gain.gain.exponentialRampToValueAtTime(0.0001, now + 6);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(now); osc.stop(now + 6.1);
        setTimeout(playMelodicBackground, 1500 + Math.random() * 1000);
    }

    function playHugChime(isGold) {
        if (!audioCtx) return;
        const now = audioCtx.currentTime;
        const f = isGold ? 880 : 440;
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.frequency.setValueAtTime(f, now);
        g.gain.setValueAtTime(0.1, now);
        g.gain.exponentialRampToValueAtTime(0.0001, now + 1);
        osc.connect(g); g.connect(audioCtx.destination);
        osc.start(now); osc.stop(now + 1.1);
    }

    function startGame() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        audioCtx.resume();
        document.getElementById('title-screen').style.display = 'none';
        document.getElementById('game-over').style.display = 'none';
        score = 0; timeLeft = 60;
        document.getElementById('score').innerText = score;
        document.getElementById('timer').innerText = timeLeft;
        gameActive = true;
        playMelodicBackground(); 
        
        const spawnInterval = setInterval(() => { 
            if(gameActive) spawnTurtle(); else clearInterval(spawnInterval);
        }, 1200);

        const clock = setInterval(() => {
            timeLeft--; 
            document.getElementById('timer').innerText = timeLeft;
            if (timeLeft <= 0) { 
                gameActive = false; 
                clearInterval(clock);
                endGame();
            }
        }, 1000);
    }

    function endGame() {
        document.getElementById('final-score').innerText = score;
        document.getElementById('name-entry-area').style.display = 'block';
        displayLeaderboard();
        document.getElementById('game-over').style.display = 'flex';
    }

    function submitScore() {
        const name = document.getElementById('player-name').value.trim() || "Turtle";
        let scores = JSON.parse(localStorage.getItem('turtleScoresStandalone') || '[]');
        scores.push({ name: name, score: score });
        scores.sort((a, b) => b.score - a.score);
        localStorage.setItem('turtleScoresStandalone', JSON.stringify(scores.slice(0, 5)));
        document.getElementById('name-entry-area').style.display = 'none';
        displayLeaderboard();
    }

    function displayLeaderboard() {
        const scores = JSON.parse(localStorage.getItem('turtleScoresStandalone') || '[]');
        document.getElementById('score-list').innerHTML = scores.map((s, i) => `
            <div class="score-row"><span>${i+1}. ${s.name}</span><span>${s.score}</span></div>
        `).join('') || "No scores yet!";
    }

    function restartGame() {
        document.querySelectorAll('.turtle-mover').forEach(t => t.remove());
        startGame();
    }

    function spawnTurtle() {
        const x = Math.random() * (window.innerWidth - 100) + 50;
        const y = Math.random() * (window.innerHeight - 250) + 125;
        const r = document.createElement('div');
        r.className = 'ripple'; r.style.left = x + 'px'; r.style.top = y + 'px';
        lake.appendChild(r);

        setTimeout(() => {
            if(!gameActive) return;
            const mover = document.createElement('div');
            mover.className = 'turtle-mover';
            mover.style.left = (x - 110) + 'px'; mover.style.top = (y - 80) + 'px';
            
            const roll = Math.random() * 100;
            let t = { c: 'green-t', p: 1, gold: false };
            if (roll > 95) t = { c: 'gold-t', p: 10, gold: true };
            else if (roll > 85) t = { c: 'brown-t', p: 3, gold: false };
            else if (roll > 70) t = { c: 'yellow-t', p: 2, gold: false };

            mover.innerHTML = `<div class="turtle-hinge">
                <div class="flipper left ${t.c}"></div><div class="flipper right ${t.c}"></div>
                <div class="head-shape ${t.c}"><div class="eye"></div><div class="mouth"></div></div>
                <div class="neck-shape ${t.c}"></div>
            </div>`;
            
            const hugAction = (e) => {
                e.preventDefault(); if (mover.classList.contains('hugging')) return;
                mover.classList.add('hugging');
                score += t.p; document.getElementById('score').innerText = score;
                playHugChime(t.gold);
                setTimeout(() => mover.remove(), 850); 
            };
            mover.onmousedown = hugAction;
            mover.ontouchstart = hugAction;
            lake.appendChild(mover);
            setTimeout(() => { if(mover.parentNode) mover.remove(); }, 2400);
        }, 400);
    }
</script>
</body>
</html>